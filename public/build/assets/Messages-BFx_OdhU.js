import{d as l,u as F,e as R,j as e,H}from"./vendor-BLTBOi2W.js";import{A}from"./AuthenticatedLayout-DNdVW90a.js";import{M as I}from"./Modal-BhZ5tikr.js";import"./ApplicationLogo-CUVqsJO0.js";function T({messages:n,advisors:b,auth:m}){const[s,g]=l.useState(null),[f,j]=l.useState(!1),[y,v]=l.useState(!1),[_,N]=l.useState(!1),c=l.useRef(null),w=l.useRef(null),{data:r,setData:i,post:k,processing:x,reset:h,errors:o}=F({subject:"",body:"",recipient_id:"",parent_id:"",attachments:[]}),L=["ðŸ‘","ðŸ‘‹","ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜…","ðŸ˜‚","ðŸ˜Š","ðŸ™‚","ðŸ˜‰","ðŸ˜","ðŸ¥°","ðŸ™","ðŸŽ‰","ðŸ”¥","ðŸ¤”","ðŸ˜Ž","ðŸŽ“","ðŸ“š"];l.useEffect(()=>{!s&&n.length>0&&window.innerWidth>=768&&C(n[0])},[n]),l.useEffect(()=>{if(s){const t=n.find(a=>a.id===s.id);t&&g(t)}},[n]),l.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[s]);const C=t=>{g(t),j(!0),i({...r,recipient_id:t.reply_to_id,parent_id:t.id,attachments:[]}),t.is_read||R.patch(route("messages.mark-read",t.id),{},{preserveScroll:!0,preserveState:!0})},z=t=>{t.target.files&&i("attachments",[...r.attachments,...Array.from(t.target.files)])},E=t=>{const a=[...r.attachments];a.splice(t,1),i("attachments",a)},$=t=>{i("body",r.body+t),v(!1)},M=t=>{t.preventDefault(),k(route("messages.store"),{onSuccess:()=>{h("body","attachments")},preserveScroll:!0,forceFormData:!0})},u=()=>{h(),N(!0)},p=()=>{N(!1),h()},B=t=>{t.preventDefault(),k(route("messages.store"),{onSuccess:()=>{p(),h()},forceFormData:!0})};return e.jsxs(A,{header:"Inbox",children:[e.jsx(H,{title:"Messages"}),e.jsx("div",{className:"py-6 md:py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg h-[80vh] flex relative",children:[e.jsxs("div",{className:`w-full md:w-1/3 border-r overflow-y-auto ${f?"hidden md:block":"block"}`,children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex justify-between items-center sticky top-0 z-10",children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"Messages"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded-full",children:n.length}),e.jsx("button",{onClick:u,className:"ml-2 bg-primary-600 text-white p-1.5 rounded-full hover:bg-primary-700 transition shadow-sm",title:"New Message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),e.jsxs("div",{className:"divide-y relative",children:[n.map(t=>e.jsxs("button",{onClick:()=>C(t),className:`w-full text-left p-4 hover:bg-gray-50 transition ${s?.id===t.id?"bg-primary-50 border-l-4 border-primary-600":"border-l-4 border-transparent"}`,children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:`font-bold text-xs px-2 py-0.5 rounded ${t.bg_color}`,children:t.sender}),e.jsx("span",{className:"text-xs text-gray-400",children:t.date})]}),e.jsx("h4",{className:`text-sm font-semibold truncate ${t.is_read?"text-gray-600":"text-black font-bold"}`,children:t.subject}),e.jsx("p",{className:"text-xs text-gray-500 truncate mt-1",children:t.preview}),t.attachments&&t.attachments.length>0&&e.jsx("div",{className:"mt-2 flex items-center gap-1 text-xs text-gray-400",children:e.jsxs("span",{children:["ðŸ“Ž ",t.attachments.length," attachment(s)"]})})]},t.id)),n.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400 text-sm",children:["No messages found. Start a conversation!",e.jsx("button",{onClick:u,className:"text-primary-600 block mt-2 mx-auto font-bold hover:underline",children:"Compose Message"})]})]})]}),e.jsx("div",{className:`w-full md:w-2/3 flex flex-col bg-gray-100 ${f?"fixed inset-0 z-20 md:static":"hidden md:flex"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 border-b flex justify-between items-center bg-white shadow-sm h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>j(!1),className:"md:hidden text-gray-500 hover:bg-gray-100 p-2 rounded-full",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg shadow",children:s.sender[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-800 leading-tight",children:s.sender}),e.jsxs("div",{className:"text-xs text-green-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full inline-block"})," Online"]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition",title:"Details",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-[#e5ddd5]",ref:c,style:{backgroundImage:'url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png")',backgroundRepeat:"repeat"},children:[s,...s.replies||[]].map((t,a)=>{const d=t.sender_id===m.user.id||t===s&&t.sender_id===m.user.id,D=t===s;return e.jsx("div",{className:`flex w-full ${d?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[75%] md:max-w-[60%] flex flex-col ${d?"items-end":"items-start"}`,children:e.jsxs("div",{className:`relative px-4 py-2 shadow-sm text-sm ${d?"bg-[#d9fdd3] text-gray-900 rounded-l-lg rounded-tr-none rounded-br-lg":"bg-white text-gray-900 rounded-r-lg rounded-tl-none rounded-bl-lg"}`,children:[D&&e.jsxs("div",{className:"text-xs font-bold text-gray-500 mb-1 pb-1 border-b border-gray-200/50 block",children:["Subject: ",t.subject]}),e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed",children:t.body}),t.attachments&&t.attachments.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-500/10",children:t.attachments.map((S,W)=>e.jsxs("a",{href:`/storage/${S.path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-black/5 p-2 rounded mb-1 last:mb-0 hover:bg-black/10 transition",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“„"}),e.jsx("span",{className:"text-xs truncate max-w-[150px] underline",children:S.name})]},W))}),e.jsxs("div",{className:`text-[10px] mt-1 text-right ${d?"text-green-800/60":"text-gray-400"}`,children:[t.date,d&&e.jsx("span",{className:"ml-1",children:"âœ“âœ“"})]})]})})},a)})}),r.attachments.length>0&&e.jsx("div",{className:"px-4 pt-2 -mb-2 flex gap-2 overflow-x-auto bg-[#f0f2f5]",children:r.attachments.map((t,a)=>e.jsxs("div",{className:"relative bg-white rounded-lg p-2 border shadow-sm flex items-center gap-2 min-w-[150px]",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center text-xs",children:"ðŸ“Ž"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-semibold truncate",children:t.name}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:[(t.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{type:"button",onClick:()=>E(a),className:"text-gray-400 hover:text-red-500",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},a))}),e.jsxs("div",{className:"p-3 bg-[#f0f2f5] border-t flex items-end gap-2",children:[e.jsx("input",{type:"file",multiple:!0,className:"hidden",ref:w,onChange:z}),e.jsx("button",{type:"button",onClick:()=>w.current?.click(),className:"p-2 text-gray-500 hover:bg-gray-200 rounded-full transition mb-1",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),e.jsxs("div",{className:"flex-1 bg-white rounded-2xl border border-gray-200 focus-within:border-gray-400 focus-within:ring-1 focus-within:ring-gray-300 shadow-sm relative",children:[e.jsx("textarea",{value:r.body,onChange:t=>i("body",t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),M(t))},placeholder:"Type a message",className:"w-full border-none rounded-2xl focus:ring-0 resize-none py-3 px-4 max-h-32 min-h-[44px] bg-transparent text-gray-800 placeholder-gray-500",rows:1,style:{height:"auto"}}),e.jsxs("div",{className:"absolute right-2 bottom-2",children:[e.jsx("button",{type:"button",onClick:()=>v(!y),className:"p-1 text-gray-400 hover:text-yellow-500 transition",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),y&&e.jsx("div",{className:"absolute bottom-10 right-0 bg-white shadow-xl border rounded-lg p-2 w-64 grid grid-cols-5 gap-1 z-50",children:L.map(t=>e.jsx("button",{type:"button",onClick:()=>$(t),className:"text-xl hover:bg-gray-100 p-1 rounded font-emoji",children:t},t))})]})]}),e.jsx("button",{onClick:M,disabled:!r.body.trim()||x,className:`p-3 rounded-full shadow-sm transition mb-1 ${r.body.trim()?"bg-[#00a884] text-white hover:bg-[#008f6f]":"bg-gray-200 text-gray-400"}`,children:x?e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-5 h-5 ml-0.5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M1.101 21.757 23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z"})})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-500 bg-[#f0f2f5] border-l border-gray-200",children:[e.jsx("div",{className:"w-32 h-32 bg-gray-200 rounded-full flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-16 h-16 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})})}),e.jsx("h3",{className:"text-2xl font-light text-gray-700 mb-2",children:"EducationForLiberty Web"}),e.jsxs("p",{className:"text-sm",children:["Send and receive messages with ",m.user.role==="student"?"your advisors":"students","."]}),e.jsxs("p",{className:"text-sm mt-4 text-gray-400 flex items-center gap-1",children:[e.jsx("span",{className:"text-xs",children:"ðŸ”’"})," End-to-end encrypted"]}),e.jsx("button",{onClick:u,className:"mt-8 px-6 py-3 bg-[#00a884] text-white rounded-full font-bold shadow-lg hover:shadow-xl hover:bg-[#008f6f] transition transform hover:-translate-y-1",children:"Start a New Chat"})]})})]})})}),e.jsx(I,{show:_,onClose:p,children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"New Message"}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To"}),e.jsxs("select",{value:r.recipient_id,onChange:t=>i("recipient_id",t.target.value),className:"w-full border-gray-300 rounded-lg focus:border-primary-500 focus:ring-primary-500",required:!0,children:[e.jsx("option",{value:"",children:"Select a Recipient"}),b&&b.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.role,")"]},t.id))]}),o.recipient_id&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:o.recipient_id})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),e.jsx("input",{type:"text",value:r.subject,onChange:t=>i("subject",t.target.value),className:"w-full border-gray-300 rounded-lg focus:border-primary-500 focus:ring-primary-500",placeholder:"Subject",required:!0}),o.subject&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:o.subject})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),e.jsx("textarea",{value:r.body,onChange:t=>i("body",t.target.value),className:"w-full border-gray-300 rounded-lg focus:border-primary-500 focus:ring-primary-500 min-h-[150px]",placeholder:"Write your message here...",required:!0}),o.body&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:o.body})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition flex items-center",children:x?"Sending...":"Send Message"})]})]})]})})]})}export{T as default};
